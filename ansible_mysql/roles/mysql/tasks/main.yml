#tasks/main.yml
---
- name: Run CentOS-specific tasks
  include: centos.yml
  when: ansible_os_family == "RedHat"

- name: Run Ubuntu-specific tasks
  include: ubuntu.yml
  when: ansible_os_family == "Debian"

- name: Update mysql root password
  mysql_user: name=root host={{host}} password={{root_pass}} login_user={{root_login}} login_password="" priv="*.*:ALL,GRANT"

- name: Create user database
  mysql_db: name={{user_db}} login_user={{root_login}} login_password={{root_pass}} state=present 

- name: Create user with all priveleges for {{user_db}} database
  mysql_user: name={{user_login}} password={{user_pass}} priv={{user_db}}.*:ALL state=present update_password=on_create login_user={{root_login}} login_password={{root_pass}} state=present

- name: Delete anonymous user
  mysql_user: user="" state="absent"